<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
    <title>‚ùÑÔ∏è –°–Ω—ñ–≥–æ–≤–∞ –ö—É–ª—è –ü—Ä–æ—Ä–æ—Ü—Ç–≤</title>
    
    <!-- MediaPipe -->
    <script src="https://cdn.jsdelivr.net/npm/@mediapipe/hands/hands.js"></script>
    
    <!-- Three.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Arial', sans-serif;
            background: linear-gradient(135deg, #0a2e5c 0%, #1a4b8c 50%, #2c3e50 100%);
            color: white;
            height: 100vh;
            width: 100vw;
            overflow: hidden;
            touch-action: none;
            -webkit-touch-callout: none;
            -webkit-user-select: none;
            user-select: none;
        }
        
        #cameraView {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            object-fit: cover;
            transform: scaleX(-1);
            z-index: 1;
            opacity: 0.3;
        }
        
        #canvas3d {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: 2;
            pointer-events: none;
        }
        
        .info-panel {
            position: absolute;
            top: 15px;
            left: 15px;
            z-index: 1000;
            background: rgba(255, 255, 255, 0.15);
            padding: 12px;
            border-radius: 15px;
            border: 2px solid rgba(173, 216, 230, 0.5);
            max-width: 280px;
            backdrop-filter: blur(15px);
            -webkit-backdrop-filter: blur(15px);
        }
        
        .prophecy-display {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            background: rgba(255, 255, 255, 0.95);
            padding: 30px 40px;
            border-radius: 25px;
            text-align: center;
            min-width: 300px;
            opacity: 0;
            border: 3px solid #4fc3f7;
            box-shadow: 
                0 0 50px rgba(79, 195, 247, 0.8),
                0 10px 30px rgba(0, 0, 0, 0.3);
            display: none;
            pointer-events: none;
        }
        
        .prophecy-text {
            font-size: 32px;
            font-weight: bold;
            color: #1565c0;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.2);
            margin-bottom: 15px;
            line-height: 1.3;
        }
        
        .timer {
            position: absolute;
            top: 15px;
            right: 15px;
            z-index: 1000;
            font-size: 56px;
            color: #4fc3f7;
            text-shadow: 
                0 0 20px #4fc3f7,
                0 0 40px rgba(79, 195, 247, 0.5);
            opacity: 0;
            font-weight: bold;
            font-family: 'Courier New', monospace;
        }
        
        @keyframes pulse {
            0% { transform: scale(1); opacity: 0.9; }
            50% { transform: scale(1.15); opacity: 1; }
            100% { transform: scale(1); opacity: 0.9; }
        }
        
        .instructions {
            position: absolute;
            bottom: 20px;
            left: 0;
            right: 0;
            text-align: center;
            z-index: 1000;
            background: rgba(0, 30, 60, 0.8);
            padding: 15px;
            border-top: 3px solid #4fc3f7;
            font-size: 16px;
            backdrop-filter: blur(10px);
            -webkit-backdrop-filter: blur(10px);
        }
        
        .hand-guide {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 3;
            text-align: center;
            background: rgba(255, 255, 255, 0.9);
            padding: 25px;
            border-radius: 20px;
            border: 3px solid #4fc3f7;
            min-width: 280px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
        }
        
        .loading {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(135deg, #0a2e5c 0%, #1a4b8c 100%);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            font-size: 24px;
        }
        
        .loading-text {
            text-align: center;
        }
        
        .countdown-animation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            z-index: 1000;
            font-size: 120px;
            color: #e3f2fd;
            text-shadow: 
                0 0 30px #4fc3f7,
                0 0 60px rgba(79, 195, 247, 0.5);
            opacity: 0;
            font-weight: bold;
        }
        
        .snowflake {
            position: absolute;
            color: white;
            font-size: 24px;
            opacity: 0.7;
            z-index: 1;
            pointer-events: none;
        }
        
        .debug-info {
            position: absolute;
            bottom: 80px;
            left: 15px;
            color: rgba(255, 255, 255, 0.7);
            font-size: 12px;
            z-index: 1000;
            background: rgba(0, 0, 0, 0.3);
            padding: 5px 10px;
            border-radius: 5px;
            display: none; /* –ü—Ä–∏—Ö–æ–≤–∞—Ç–∏ –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω—É */
        }
        
        /* –ê–¥–∞–ø—Ç–∞—Ü—ñ—è –¥–ª—è iOS */
        @supports (-webkit-touch-callout: none) {
            .info-panel, .instructions {
                backdrop-filter: blur(20px);
                -webkit-backdrop-filter: blur(20px);
            }
        }
    </style>
</head>
<body>
    <!-- –ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø -->
    <div class="loading" id="loadingScreen">
        <div class="loading-text">
            <div style="font-size: 70px; margin-bottom: 20px;">‚ùÑÔ∏è</div>
            <div style="font-size: 28px; margin-bottom: 10px;">–°–Ω—ñ–≥–æ–≤–∞ –ö—É–ª—è –ü—Ä–æ—Ä–æ—Ü—Ç–≤</div>
            <div style="color: #b3e5fc; font-size: 16px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
        </div>
    </div>

    <!-- –ì–ê–ô–î –î–û–õ–û–ù–Ü -->
    <div class="hand-guide" id="handGuide">
        <div style="font-size: 70px; margin-bottom: 15px;">üñêÔ∏è</div>
        <div style="font-size: 22px; margin-bottom: 10px; color: #1565c0;">–ü–æ–∫–∞–∂—ñ—Ç—å –¥–æ–ª–æ–Ω—é –∫–∞–º–µ—Ä—ñ</div>
        <div style="color: #546e7a; font-size: 16px;">–¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –∫—É–ª—ñ –Ω–∞ 3 —Å–µ–∫—É–Ω–¥–∏</div>
    </div>

    <!-- –Ü–ù–§–û–ü–ê–ù–ï–õ–¨ -->
    <div class="info-panel">
        <h1 style="color: #4fc3f7; margin-bottom: 8px; font-size: 22px;">‚ùÑÔ∏è –°–ù–Ü–ì–û–í–ê –ö–£–õ–Ø</h1>
        <p style="color: #e3f2fd; font-size: 16px;">–¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è —Å–Ω—ñ–≥–æ–≤–æ—ó –∫—É–ª—ñ –ø–∞–ª—å—Ü–µ–º</p>
        <p style="margin-top: 10px; color: #4fc3f7; font-size: 18px;">
            –ü—Ä–æ—Ä–æ—Ü—Ç–≤–∞: <span id="prophecyCount">0</span>
        </p>
    </div>

    <!-- –¢–ê–ô–ú–ï–† 3 –°–ï–ö–£–ù–î–ò -->
    <div class="timer" id="timer">3</div>

    <!-- –ê–ù–Ü–ú–ê–¶–Ü–Ø –í–Ü–î–õ–Ü–ö–£ -->
    <div class="countdown-animation" id="countdownAnim"></div>

    <!-- –ü–†–û–†–û–¶–¢–í–û -->
    <div class="prophecy-display" id="prophecyDisplay">
        <div class="prophecy-text" id="prophecyText"></div>
        <div style="color: #78909c; font-size: 16px; margin-top: 15px;">‚ú® –°–≤—ñ—Ç–ª–æ –†—ñ–∑–¥–≤–∞ –∑ –≤–∞–º–∏ ‚ú®</div>
    </div>

    <!-- –Ü–ù–°–¢–†–£–ö–¶–Ü–á -->
    <div class="instructions">
        <p>‚ùÑÔ∏è <span style="color: #4fc3f7; font-weight: bold;">–°–Ω—ñ–≥–æ–≤–∞ –º–∞–≥—ñ—è</span> ‚Ä¢ üëÜ <span style="color: #4fc3f7; font-weight: bold;">–¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –Ω–∞ 3 —Å–µ–∫—É–Ω–¥–∏</span> ‚Ä¢ üîÆ <span style="color: #4fc3f7; font-weight: bold;">–†—ñ–∑–¥–≤—è–Ω–µ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ</span></p>
    </div>

    <!-- –°–ù–Ü–ñ–ò–ù–ö–ò -->
    <div id="snowflakes"></div>

    <!-- –í–Ü–î–ï–û –¢–ê 3D -->
    <video id="cameraView" autoplay playsinline></video>
    <canvas id="canvas3d"></canvas>

    <script>
        // ========== –ö–û–ù–§–Ü–ì–£–†–ê–¶–Ü–Ø ==========
        const CONFIG = {
            COUNTDOWN_TIME: 3,
            PROPHECY_TIME: 5,
            SPHERE_RADIUS: 0.25,
            TOUCH_DISTANCE: 0.4,
            TEXT_SCALE_MULTIPLIER: 3,
            TEXT_SPEED_MULTIPLIER: 3
        };

        // ========== –ü–†–û–†–û–¶–¢–í–ê –ó–ò–ú–û–í–û–á –¢–ï–ú–ò ==========
        const PROPHECIES_WINTER = [
            "–ú–∏—Ä —É –≤–∞—à–æ–º—É –¥–æ–º—ñ! ‚ùÑÔ∏è",
            "–†–∞–¥—ñ—Å—Ç—å —É —Å–µ—Ä—Ü—ñ! ‚ú®",
            "–õ—é–±–æ–≤ –∑–∞–≤–∂–¥–∏ –ø–æ—Ä—è–¥! üíô",
            "–ó–¥–æ—Ä–æ–≤'—è –º—ñ—Ü–Ω—ñ—î! üåü",
            "–©–∞—Å—Ç—è –ø—Ä–∏—Ö–æ–¥–∏—Ç—å! üéÑ",
            "–ú—Ä—ñ—ó –∑–±—É–≤–∞—é—Ç—å—Å—è! üåå",
            "–£—Å–ø—ñ—Ö —á–µ–∫–∞—î! üöÄ",
            "–ì–∞—Ä–º–æ–Ω—ñ—è –∑ –ø—Ä–∏—Ä–æ–¥–æ—é! üå≤",
            "–°–≤—ñ—Ç–ª–æ –ø–µ—Ä–µ–º–∞–≥–∞—î! üí´",
            "–î–æ–±—Ä–æ –ø–æ–≤–µ—Ä—Ç–∞—î—Ç—å—Å—è! ‚ù§Ô∏è",
            "–ù–∞–¥—ñ—è –∑–∞–≤–∂–¥–∏ –∑ –≤–∞–º–∏! üå†",
            "–°–∏–ª–∞ —É –ø—Ä–æ—Å—Ç–æ—Ç—ñ! ‚õÑ",
            "–ß–∏—Å—Ç–æ—Ç–∞ –ø–æ–º–∏—Å–ª—ñ–≤! üí≠",
            "–¢–µ–ø–ª–æ –≤–∑–∏–º–∫—É! üî•",
            "–ß–∞—Ä—ñ–≤–Ω—ñ—Å—Ç—å –†—ñ–∑–¥–≤–∞! üéÅ"
        ];

        // ========== –ì–õ–û–ë–ê–õ–¨–ù–Ü –ó–ú–Ü–ù–ù–Ü ==========
        let scene, camera, renderer, sphere, prophecyTextGroup;
        let hands, cameraStream;
        let isCounting = false;
        let isRevealing = false;
        let prophecyCount = 0;
        let currentCountdown = CONFIG.COUNTDOWN_TIME;
        let spherePosition = { x: 0, y: 0, z: -1.5 };
        let handDetected = false;
        let touchStartTime = 0;
        let isTouching = false;
        let originalTextScale = new THREE.Vector3();
        let prophecyActive = false;
        let textSpeedMultiplier = 1;

        // ========== DOM –ï–õ–ï–ú–ï–ù–¢–ò ==========
        const elements = {
            loading: document.getElementById('loadingScreen'),
            handGuide: document.getElementById('handGuide'),
            prophecyDisplay: document.getElementById('prophecyDisplay'),
            prophecyText: document.getElementById('prophecyText'),
            timer: document.getElementById('timer'),
            countdownAnim: document.getElementById('countdownAnim'),
            prophecyCount: document.getElementById('prophecyCount'),
            cameraView: document.getElementById('cameraView'),
            canvas3d: document.getElementById('canvas3d'),
            snowflakes: document.getElementById('snowflakes')
        };

        // ========== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø THREE.JS ==========
        function initThreeJS() {
            // –°—Ü–µ–Ω–∞ –∑ –∑–∏–º–æ–≤–∏–º –∫–æ–ª—å–æ—Ä–æ–º
            scene = new THREE.Scene();
            scene.fog = new THREE.Fog(0x0a2e5c, 5, 15);
            
            // –ö–∞–º–µ—Ä–∞
            camera = new THREE.PerspectiveCamera(60, window.innerWidth / window.innerHeight, 0.1, 100);
            camera.position.z = 5;
            
            // –†–µ–Ω–¥–µ—Ä–µ—Ä –∑ –æ–ø—Ç–∏–º—ñ–∑–∞—Ü—ñ—è–º–∏ –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö
            renderer = new THREE.WebGLRenderer({ 
                canvas: elements.canvas3d, 
                alpha: true, 
                antialias: window.devicePixelRatio < 2,
                powerPreference: "high-performance",
                preserveDrawingBuffer: false
            });
            
            const pixelRatio = Math.min(window.devicePixelRatio, 1.5);
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(pixelRatio);
            renderer.shadowMap.enabled = false;
            
            // –û—Å–≤—ñ—Ç–ª–µ–Ω–Ω—è –¥–ª—è –∑–∏–º–æ–≤–æ—ó —Å—Ü–µ–Ω–∏
            const ambientLight = new THREE.AmbientLight(0xb3e5fc, 0.7);
            scene.add(ambientLight);
            
            const directionalLight = new THREE.DirectionalLight(0xffffff, 1);
            directionalLight.position.set(10, 20, 15);
            directionalLight.castShadow = false;
            scene.add(directionalLight);
            
            const pointLight = new THREE.PointLight(0x4fc3f7, 2, 20);
            pointLight.position.set(0, 3, 2);
            scene.add(pointLight);
            
            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è –∑–∏–º–æ–≤–æ—ó –∫—É–ª—ñ
            createWinterSphere();
            
            // –°—Ç–≤–æ—Ä–µ–Ω–Ω—è —Ç–µ–∫—Å—Ç—É –ø—Ä–æ—Ä–æ—Ü—Ç–≤–∞ (3D)
            createProphecyText();
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è
            animate();
            
            // –°–Ω—ñ–∂–∏–Ω–∫–∏ –Ω–∞ —Ñ–æ–Ω—ñ
            createSnowflakes();
            
            // –ü—Ä–∏—Ö–æ–≤—É—î–º–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è
            setTimeout(() => {
                elements.loading.style.opacity = '0';
                setTimeout(() => {
                    elements.loading.style.display = 'none';
                }, 500);
            }, 1500);
        }

        // ========== –°–¢–í–û–†–ï–ù–ù–Ø –ó–ò–ú–û–í–û–á –ö–£–õ–Ü ==========
        function createWinterSphere() {
            // –û–ø—Ç–∏–º—ñ–∑–æ–≤–∞–Ω–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö
            const sphereGeometry = new THREE.SphereGeometry(
                CONFIG.SPHERE_RADIUS, 
                isMobile() ? 32 : 48, 
                isMobile() ? 32 : 48
            );
            
            const sphereMaterial = new THREE.MeshPhongMaterial({
                color: 0xe3f2fd,
                transparent: true,
                opacity: 0.95,
                emissive: 0x4fc3f7,
                emissiveIntensity: 0.6,
                shininess: 80,
                side: THREE.DoubleSide,
                specular: 0xffffff,
                reflectivity: 0.5
            });
            
            sphere = new THREE.Mesh(sphereGeometry, sphereMaterial);
            scene.add(sphere);
            
            // –í–Ω—É—Ç—Ä—ñ—à–Ω—è –∫—É–ª—è (–ª—å–æ–¥—è–Ω–µ —è–¥—Ä–æ)
            const innerGeometry = new THREE.SphereGeometry(CONFIG.SPHERE_RADIUS * 0.7, 24, 24);
            const innerMaterial = new THREE.MeshBasicMaterial({
                color: 0xbbdefb,
                transparent: true,
                opacity: 0.4,
                side: THREE.DoubleSide
            });
            
            const innerSphere = new THREE.Mesh(innerGeometry, innerMaterial);
            sphere.add(innerSphere);
            
            // –°–Ω—ñ–∂–∏–Ω–∫–∏ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ –∫—É–ª—ñ
            createSnowflakesInside();
            
            // –ö—ñ–ª—å—Ü–µ –¥–ª—è —Ç–æ—Ä–∫–∞–Ω–Ω—è
            const ringGeometry = new THREE.RingGeometry(
                CONFIG.SPHERE_RADIUS * 1.3, 
                CONFIG.SPHERE_RADIUS * 1.5, 
                32
            );
            const ringMaterial = new THREE.MeshBasicMaterial({
                color: 0x4fc3f7,
                transparent: true,
                opacity: 0.5,
                side: THREE.DoubleSide
            });
            
            const ring = new THREE.Mesh(ringGeometry, ringMaterial);
            ring.rotation.x = -Math.PI / 2;
            sphere.add(ring);
            sphere.userData.ring = ring;
        }

        // ========== –°–ù–Ü–ñ–ò–ù–ö–ò –í–°–ï–†–ï–î–ò–ù–Ü –ö–£–õ–Ü ==========
        function createSnowflakesInside() {
            const snowflakeCount = isMobile() ? 30 : 60;
            const snowflakes = new THREE.BufferGeometry();
            const positions = new Float32Array(snowflakeCount * 3);
            
            for (let i = 0; i < snowflakeCount * 3; i += 3) {
                const radius = CONFIG.SPHERE_RADIUS * 0.6;
                const theta = Math.random() * Math.PI * 2;
                const phi = Math.acos(2 * Math.random() - 1);
                
                positions[i] = radius * Math.sin(phi) * Math.cos(theta);
                positions[i + 1] = radius * Math.sin(phi) * Math.sin(theta);
                positions[i + 2] = radius * Math.cos(phi);
            }
            
            snowflakes.setAttribute('position', new THREE.BufferAttribute(positions, 3));
            
            const snowflakeMaterial = new THREE.PointsMaterial({
                size: 0.03,
                color: 0xffffff,
                transparent: true,
                opacity: 0.8,
                blending: THREE.AdditiveBlending
            });
            
            const snowflakeSystem = new THREE.Points(snowflakes, snowflakeMaterial);
            sphere.add(snowflakeSystem);
            sphere.userData.snowflakes = snowflakeSystem;
            sphere.userData.snowflakePositions = positions.slice();
        }

        // ========== –°–¢–í–û–†–ï–ù–ù–Ø 3D –¢–ï–ö–°–¢–£ –ü–†–û–†–û–¶–¢–í–ê ==========
        function createProphecyText() {
            // –ì—Ä—É–ø–∞ –¥–ª—è —Ç–µ–∫—Å—Ç—É
            prophecyTextGroup = new THREE.Group();
            scene.add(prophecyTextGroup);
            
            // –ë–∞–∑–æ–≤–∞ –≥–µ–æ–º–µ—Ç—Ä—ñ—è —Ç–µ–∫—Å—Ç—É
            const textGeometry = new THREE.PlaneGeometry(2, 0.5);
            const textMaterial = new THREE.MeshBasicMaterial({
                color: 0x1565c0,
                transparent: true,
                opacity: 0,
                side: THREE.DoubleSide
            });
            
            const textMesh = new THREE.Mesh(textGeometry, textMaterial);
            prophecyTextGroup.add(textMesh);
            
            // –ó–±–µ—Ä—ñ–≥–∞—î–º–æ –ø–æ—á–∞—Ç–∫–æ–≤–∏–π —Ä–æ–∑–º—ñ—Ä
            originalTextScale.copy(textMesh.scale);
            
            // –¢–µ–∫—Å—Ç—É—Ä–∞ –∑ —Ç–µ–∫—Å—Ç–æ–º –±—É–¥–µ —Å—Ç–≤–æ—Ä–µ–Ω–∞ –¥–∏–Ω–∞–º—ñ—á–Ω–æ
            prophecyTextGroup.userData.textMesh = textMesh;
            prophecyTextGroup.userData.currentText = "";
            prophecyTextGroup.visible = false;
        }

        // ========== –û–ù–û–í–õ–ï–ù–ù–Ø 3D –¢–ï–ö–°–¢–£ ==========
        function update3DText(text) {
            const canvas = document.createElement('canvas');
            const context = canvas.getContext('2d');
            canvas.width = 1024;
            canvas.height = 256;
            
            // –û—á–∏—â–∞—î–º–æ
            context.clearRect(0, 0, canvas.width, canvas.height);
            
            // –§–æ–Ω
            context.fillStyle = 'rgba(255, 255, 255, 0.9)';
            context.fillRect(0, 0, canvas.width, canvas.height);
            
            // –¢–µ–∫—Å—Ç
            context.font = 'bold 80px Arial, sans-serif';
            context.textAlign = 'center';
            context.textBaseline = 'middle';
            context.fillStyle = '#1565c0';
            
            // –û–±–≤–æ–¥–∫–∞
            context.strokeStyle = '#ffffff';
            context.lineWidth = 6;
            context.strokeText(text, canvas.width/2, canvas.height/2);
            
            // –ó–∞–ø–æ–≤–Ω–µ–Ω–Ω—è
            context.fillText(text, canvas.width/2, canvas.height/2);
            
            // –û–Ω–æ–≤–ª—é—î–º–æ —Ç–µ–∫—Å—Ç—É—Ä—É
            const texture = new THREE.CanvasTexture(canvas);
            texture.needsUpdate = true;
            
            prophecyTextGroup.userData.textMesh.material.map = texture;
            prophecyTextGroup.userData.textMesh.material.needsUpdate = true;
            prophecyTextGroup.userData.currentText = text;
        }

        // ========== –°–ù–Ü–ñ–ò–ù–ö–ò –ù–ê –§–û–ù–Ü ==========
        function createSnowflakes() {
            const snowflakeCount = isMobile() ? 40 : 80;
            const flakes = [];
            
            for (let i = 0; i < snowflakeCount; i++) {
                const flake = document.createElement('div');
                flake.className = 'snowflake';
                flake.innerHTML = '‚ùÑÔ∏è';
                flake.style.left = Math.random() * 100 + '%';
                flake.style.top = Math.random() * 100 + '%';
                flake.style.fontSize = (Math.random() * 20 + 15) + 'px';
                flake.style.opacity = Math.random() * 0.5 + 0.3;
                flake.style.animation = `fall ${Math.random() * 10 + 10}s linear infinite`;
                elements.snowflakes.appendChild(flake);
                flakes.push(flake);
            }
            
            // CSS –¥–ª—è –∞–Ω—ñ–º–∞—Ü—ñ—ó –ø–∞–¥—ñ–Ω–Ω—è
            const style = document.createElement('style');
            style.textContent = `
                @keyframes fall {
                    0% { transform: translateY(-100px) rotate(0deg); }
                    100% { transform: translateY(100vh) rotate(360deg); }
                }
            `;
            document.head.appendChild(style);
        }

        // ========== –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø –¢–†–ï–ö–Ü–ù–ì–£ –†–£–ö ==========
        function initHandTracking() {
            hands = new Hands({
                locateFile: (file) => {
                    return `https://cdn.jsdelivr.net/npm/@mediapipe/hands/${file}`;
                }
            });

            hands.setOptions({
                maxNumHands: 1,
                modelComplexity: isMobile() ? 0 : 1,
                minDetectionConfidence: 0.6,
                minTrackingConfidence: 0.6
            });

            hands.onResults(onHandResults);

            // –ó–∞–ø—É—Å–∫ –∑–∞–¥–Ω—å–æ—ó –∫–∞–º–µ—Ä–∏
            startBackCamera();
        }

        // ========== –ó–ê–ü–£–°–ö –ó–ê–î–ù–¨–û–á –ö–ê–ú–ï–†–ò ==========
        async function startBackCamera() {
            try {
                const constraints = {
                    video: {
                        facingMode: { exact: 'environment' },
                        width: { ideal: 1280 },
                        height: { ideal: 720 }
                    }
                };

                // –°–ø—Ä–æ–±–∞ –æ—Ç—Ä–∏–º–∞—Ç–∏ –∑–∞–¥–Ω—é –∫–∞–º–µ—Ä—É
                let stream;
                try {
                    stream = await navigator.mediaDevices.getUserMedia(constraints);
                } catch (backError) {
                    // –Ø–∫—â–æ –∑–∞–¥–Ω—è –∫–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –±–µ—Ä–µ–º–æ –±—É–¥—å-—è–∫—É
                    console.log("–ó–∞–¥–Ω—è –∫–∞–º–µ—Ä–∞ –Ω–µ–¥–æ—Å—Ç—É–ø–Ω–∞, –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—é –±—É–¥—å-—è–∫—É –∫–∞–º–µ—Ä—É");
                    stream = await navigator.mediaDevices.getUserMedia({
                        video: { width: { ideal: 1280 }, height: { ideal: 720 } }
                    });
                }

                elements.cameraView.srcObject = stream;
                cameraStream = stream;

                // –ó–∞–ø—É—Å–∫ –æ–±—Ä–æ–±–∫–∏ –∫–∞–¥—Ä—ñ–≤
                const processFrame = async () => {
                    if (elements.cameraView.readyState >= 2) {
                        try {
                            await hands.send({ image: elements.cameraView });
                        } catch (e) {
                            console.warn("–ü–æ–º–∏–ª–∫–∞ MediaPipe:", e);
                        }
                    }
                    requestAnimationFrame(processFrame);
                };

                elements.cameraView.onloadeddata = processFrame;

            } catch (error) {
                console.error("–ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏:", error);
                elements.handGuide.innerHTML = `
                    <div style="color: #ff6b6b; font-size: 20px;">‚ö†Ô∏è –ü–æ–º–∏–ª–∫–∞ –∫–∞–º–µ—Ä–∏</div>
                    <div style="color: #546e7a; margin-top: 10px;">–î–æ–∑–≤–æ–ª—å—Ç–µ –¥–æ—Å—Ç—É–ø –¥–æ –∫–∞–º–µ—Ä–∏</div>
                `;
            }
        }

        // ========== –û–ë–†–û–ë–ö–ê –†–ï–ó–£–õ–¨–¢–ê–¢–Ü–í –¢–†–ï–ö–Ü–ù–ì–£ ==========
        function onHandResults(results) {
            if (results.multiHandLandmarks && results.multiHandLandmarks.length > 0) {
                if (!handDetected) {
                    handDetected = true;
                    elements.handGuide.style.opacity = '0';
                    setTimeout(() => {
                        elements.handGuide.style.display = 'none';
                    }, 300);
                }
                
                const landmarks = results.multiHandLandmarks[0];
                
                // –ü–æ–∑–∏—Ü—ñ—è –¥–æ–ª–æ–Ω—ñ
                const wrist = landmarks[0];
                const middleBase = landmarks[9];
                
                const palmX = (wrist.x + middleBase.x) / 2;
                const palmY = (wrist.y + middleBase.y) / 2;
                
                // –ú–∞–ø—É–≤–∞–Ω–Ω—è –Ω–∞ 3D –∫–æ–æ—Ä–¥–∏–Ω–∞—Ç–∏
                spherePosition.x = (palmX * 2 - 1) * 2.5;
                spherePosition.y = -(palmY * 2 - 1) * 1.5 + 0.5;
                
                // –ü–æ–∑–∏—Ü—ñ—è –≤–∫–∞–∑—ñ–≤–Ω–æ–≥–æ –ø–∞–ª—å—Ü—è
                const indexTip = landmarks[8];
                const touchX = (indexTip.x * 2 - 1) * 2.5;
                const touchY = -(indexTip.y * 2 - 1) * 1.5 + 0.5;
                
                const distance = Math.sqrt(
                    Math.pow(touchX - spherePosition.x, 2) + 
                    Math.pow(touchY - spherePosition.y, 2)
                );
                
                // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ —Ç–æ—Ä–∫–∞–Ω–Ω—è
                if (distance < CONFIG.TOUCH_DISTANCE && !prophecyActive) {
                    if (!isTouching) {
                        isTouching = true;
                        touchStartTime = Date.now();
                        if (sphere.userData.ring) {
                            sphere.userData.ring.material.color.setHex(0xff6b6b);
                            sphere.userData.ring.material.opacity = 0.8;
                        }
                    }
                    
                    const touchDuration = (Date.now() - touchStartTime) / 1000;
                    if (touchDuration >= CONFIG.COUNTDOWN_TIME && !isCounting) {
                        startCountdown();
                    }
                } else {
                    if (isTouching) {
                        isTouching = false;
                        if (sphere.userData.ring) {
                            sphere.userData.ring.material.color.setHex(0x4fc3f7);
                            sphere.userData.ring.material.opacity = 0.5;
                        }
                    }
                }
            } else {
                if (handDetected) {
                    handDetected = false;
                    elements.handGuide.style.display = 'block';
                    setTimeout(() => {
                        elements.handGuide.style.opacity = '1';
                    }, 10);
                }
                isTouching = false;
            }
        }

        // ========== –ó–ê–ü–£–°–ö –í–Ü–î–õ–Ü–ö–£ 3 –°–ï–ö–£–ù–î ==========
        function startCountdown() {
            if (isCounting || prophecyActive) return;
            
            isCounting = true;
            currentCountdown = CONFIG.COUNTDOWN_TIME;
            prophecyActive = true;
            
            // –ü—Ä–∏—à–≤–∏–¥—à–µ–Ω–Ω—è –æ–±–µ—Ä—Ç–∞–Ω–Ω—è
            textSpeedMultiplier = CONFIG.TEXT_SPEED_MULTIPLIER;
            
            // –ü–æ–∫–∞–∑—É—î–º–æ —Ç–∞–π–º–µ—Ä
            elements.timer.style.opacity = '1';
            elements.timer.textContent = currentCountdown;
            elements.timer.style.animation = 'pulse 0.5s infinite';
            
            // –ï—Ñ–µ–∫—Ç–∏ –∫—É–ª—ñ
            if (sphere) {
                sphere.material.color.setHex(0xff6b6b);
                sphere.material.emissive.setHex(0xff6b6b);
                sphere.material.emissiveIntensity = 1.5;
            }
            
            // –í—ñ–¥–ª—ñ–∫ 3 —Å–µ–∫—É–Ω–¥
            const countdownInterval = setInterval(() => {
                currentCountdown--;
                elements.timer.textContent = currentCountdown;
                
                // –ê–Ω—ñ–º–∞—Ü—ñ—è —Ü–∏—Ñ—Ä
                elements.countdownAnim.textContent = currentCountdown + 1;
                elements.countdownAnim.style.opacity = '1';
                
                setTimeout(() => {
                    elements.countdownAnim.style.opacity = '0';
                }, 300);
                
                // –ö—ñ–Ω–µ—Ü—å –≤—ñ–¥–ª—ñ–∫—É
                if (currentCountdown <= 0) {
                    clearInterval(countdownInterval);
                    finishCountdown();
                }
            }, 1000);
        }

        // ========== –ó–ê–í–ï–†–®–ï–ù–ù–Ø –í–Ü–î–õ–Ü–ö–£ ==========
        function finishCountdown() {
            isCounting = false;
            
            // –ó—É–ø–∏–Ω—è—î–º–æ –∫—É–ª—é
            textSpeedMultiplier = 0;
            
            // –í—ñ–±—Ä–∞—Ü—ñ—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞
            if (navigator.vibrate) {
                navigator.vibrate([200, 100, 200]);
            }
            
            // –•–æ–≤–∞—î–º–æ —Ç–∞–π–º–µ—Ä
            elements.timer.style.opacity = '0';
            elements.timer.style.animation = 'none';
            
            // –ü–æ–∫–∞–∑—É—î–º–æ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
            showProphecy();
            
            // –ê–Ω—ñ–º–∞—Ü—ñ—è –∑—É–ø–∏–Ω–∫–∏ –∫—É–ª—ñ
            if (sphere) {
                sphere.material.color.setHex(0x4fc3f7);
                sphere.material.emissive.setHex(0x4fc3f7);
                sphere.material.emissiveIntensity = 1;
                
                // –ï—Ñ–µ–∫—Ç —Å–ø–∞–ª–∞—Ö—É
                setTimeout(() => {
                    sphere.material.emissiveIntensity = 2;
                    setTimeout(() => {
                        sphere.material.emissiveIntensity = 1;
                    }, 200);
                }, 100);
            }
        }

        // ========== –ü–û–ö–ê–ó –ü–†–û–†–û–¶–¢–í–ê ==========
        function showProphecy() {
            // –û–±–∏—Ä–∞—î–º–æ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
            const prophecy = PROPHECIES_WINTER[Math.floor(Math.random() * PROPHECIES_WINTER.length)];
            
            // –û–Ω–æ–≤–ª—é—î–º–æ 3D —Ç–µ–∫—Å—Ç
            update3DText(prophecy);
            
            // –ü–æ–∫–∞–∑—É—î–º–æ 3D —Ç–µ–∫—Å—Ç
            prophecyTextGroup.visible = true;
            prophecyTextGroup.position.copy(sphere.position);
            prophecyTextGroup.position.y += CONFIG.SPHERE_RADIUS * 2;
            prophecyTextGroup.userData.textMesh.material.opacity = 1;
            
            // –ó–±—ñ–ª—å—à—É—î–º–æ —Ç–µ–∫—Å—Ç –≤ 3 —Ä–∞–∑–∏
            prophecyTextGroup.userData.textMesh.scale.multiplyScalar(CONFIG.TEXT_SCALE_MULTIPLIER);
            
            // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ç–µ–∫—Å—Ç –¥–æ –∫–∞–º–µ—Ä–∏
            prophecyTextGroup.lookAt(camera.position);
            
            // –û–Ω–æ–≤–ª—é—î–º–æ –ª—ñ—á–∏–ª—å–Ω–∏–∫
            prophecyCount++;
            elements.prophecyCount.textContent = prophecyCount;
            
            // –°–∫–∏–¥–∞–Ω–Ω—è —á–µ—Ä–µ–∑ 5 —Å–µ–∫—É–Ω–¥
            setTimeout(() => {
                resetAfterProphecy();
            }, CONFIG.PROPHECY_TIME * 1000);
        }

        // ========== –°–ö–ò–î–ê–ù–ù–Ø –ü–Ü–°–õ–Ø –ü–†–û–†–û–¶–¢–í–ê ==========
        function resetAfterProphecy() {
            // –ü–æ–≤–µ—Ä—Ç–∞—î–º–æ —Ç–µ–∫—Å—Ç –¥–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ–≥–æ —Ä–æ–∑–º—ñ—Ä—É
            prophecyTextGroup.userData.textMesh.scale.copy(originalTextScale);
            prophecyTextGroup.userData.textMesh.material.opacity = 0;
            prophecyTextGroup.visible = false;
            
            // –°–∫–∏–¥–∞—î–º–æ –ø—Ä–∞–ø–æ—Ä—Ü—ñ
            prophecyActive = false;
            isCounting = false;
            isTouching = false;
            
            // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –Ω–æ—Ä–º–∞–ª—å–Ω—É —à–≤–∏–¥–∫—ñ—Å—Ç—å
            textSpeedMultiplier = 1;
            
            // –í—ñ–¥–Ω–æ–≤–ª—é—î–º–æ –∫—ñ–ª—å—Ü–µ
            if (sphere.userData.ring) {
                sphere.userData.ring.material.color.setHex(0x4fc3f7);
                sphere.userData.ring.material.opacity = 0.5;
            }
        }

        // ========== –ê–ù–Ü–ú–ê–¶–Ü–Ø ==========
        function animate() {
            requestAnimationFrame(animate);
            
            if (sphere) {
                // –û–±–µ—Ä—Ç–∞–Ω–Ω—è –∫—É–ª—ñ –∑—ñ –∑–º—ñ–Ω–Ω–æ—é —à–≤–∏–¥–∫—ñ—Å—Ç—é
                sphere.rotation.y += 0.01 * textSpeedMultiplier;
                sphere.rotation.x += 0.005 * textSpeedMultiplier;
                
                // –ü–ª–∞–≤–Ω–µ –ø–µ—Ä–µ–º—ñ—â–µ–Ω–Ω—è –¥–æ –¥–æ–ª–æ–Ω—ñ
                sphere.position.x += (spherePosition.x - sphere.position.x) * 0.3;
                sphere.position.y += (spherePosition.y - sphere.position.y) * 0.3;
                
                // –ê–Ω—ñ–º–∞—Ü—ñ—è —Å–Ω—ñ–∂–∏–Ω–æ–∫ –≤—Å–µ—Ä–µ–¥–∏–Ω—ñ
                if (sphere.userData.snowflakes && sphere.userData.snowflakePositions) {
                    const positions = sphere.userData.snowflakes.geometry.attributes.position.array;
                    const originals = sphere.userData.snowflakePositions;
                    const time = Date.now() * 0.001;
                    
                    for (let i = 0; i < positions.length; i += 3) {
                        positions[i] = originals[i] + Math.sin(time + i) * 0.02;
                        positions[i + 1] = originals[i + 1] + Math.cos(time * 0.7 + i) * 0.02;
                        positions[i + 2] = originals[i + 2] + Math.sin(time * 0.5 + i) * 0.02;
                    }
                    
                    sphere.userData.snowflakes.geometry.attributes.position.needsUpdate = true;
                }
                
                // –ü—É–ª—å—Å–∞—Ü—ñ—è –∫—ñ–ª—å—Ü—è
                if (sphere.userData.ring && !isCounting) {
                    const pulse = Math.sin(Date.now() * 0.002) * 0.15 + 1;
                    sphere.userData.ring.scale.set(pulse, pulse, 1);
                }
            }
            
            // –¢–µ–∫—Å—Ç —Å–ª—ñ–¥—É—î –∑–∞ –∫—É–ª–µ—é —Ç–∞ –∑–∞–≤–∂–¥–∏ –¥–∏–≤–∏—Ç—å—Å—è –Ω–∞ –∫–∞–º–µ—Ä—É
            if (prophecyTextGroup.visible) {
                prophecyTextGroup.position.x = sphere.position.x;
                prophecyTextGroup.position.y = sphere.position.y + CONFIG.SPHERE_RADIUS * 2;
                prophecyTextGroup.lookAt(camera.position);
            }
            
            renderer.render(scene, camera);
        }

        // ========== –î–û–ü–û–ú–Ü–ñ–ù–Ü –§–£–ù–ö–¶–Ü–á ==========
        function isMobile() {
            return /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent);
        }

        // ========== –ó–ê–ü–£–°–ö –î–û–î–ê–¢–ö–£ ==========
        window.addEventListener('load', () => {
            initThreeJS();
            initHandTracking();
            
            // –†–µ—Å–∞–π–∑ –≤—ñ–∫–Ω–∞
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            });
            
            // –ó–∞–ø–æ–±—ñ–≥–∞–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ñ–π –ø–æ–≤–µ–¥—ñ–Ω—Ü—ñ –±—Ä–∞—É–∑–µ—Ä–∞
            document.addEventListener('touchstart', (e) => {
                if (e.target === elements.canvas3d) {
                    e.preventDefault();
                }
            }, { passive: false });
            
            document.addEventListener('touchmove', (e) => {
                if (e.target === elements.canvas3d) {
                    e.preventDefault();
                }
            }, { passive: false });
        });
    </script>
</body>
</html>
