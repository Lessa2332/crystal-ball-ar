<!DOCTYPE html>
<html lang="uk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>üîÆ –ö—Ä–∏—à—Ç–∞–ª–µ–≤–∞ –ö—É–ª—è –ü—Ä–æ—Ä–æ—Ü—Ç–≤ AR</title>

    <script src="https://aframe.io/releases/1.4.0/aframe.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/mind-ar@1.2.3/dist/mindar-image-aframe.prod.js"></script>
    
    <!-- –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–¥–∞–ª–µ–Ω–æ –ø—Ä–æ–±–ª–µ–º–Ω—ñ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∏ -->
    <!-- <script src="https://unpkg.com/aframe-particle-system-component@1.1.3/dist/aframe-particle-system-component.min.js"></script> -->
    <!-- <script src="https://cdn.jsdelivr.net/gh/donmccurdy/aframe-text-geometry-component@v0.5.2/dist/aframe-text-geometry-component.min.js"></script> -->
    
    <style>
        /* –ê–î–ê–ü–¢–ò–í–ù–Ü–°–¢–¨: –ó–∞–±–µ–∑–ø–µ—á–µ–Ω–Ω—è –ø–æ–≤–Ω–æ–µ–∫—Ä–∞–Ω–Ω–æ–≥–æ —Ä–µ–∂–∏–º—É –Ω–∞ –≤—Å—ñ—Ö –ø—Ä–∏—Å—Ç—Ä–æ—è—Ö */
        body {
            margin: 0;
            padding: 0;
            background: #000;
            font-family: Arial, sans-serif;
            /* –ó–∞–±–æ—Ä–æ–Ω—è—î –ø—Ä–æ–∫—Ä—É—Ç–∫—É */
            overflow: hidden; 
            /* –§—ñ–∫—Å—É—î —Ä–æ–∑–º—ñ—Ä –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ */
            width: 100vw;
            height: 100vh;
        }
        
        a-scene {
            display: block;
            width: 100%;
            height: 100%;
        }

        /* –ï–∫—Ä–∞–Ω –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è */
        #loading-screen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: #000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            z-index: 9999;
            color: #fff;
            text-align: center; /* –í–∏—Ä—ñ–≤–Ω—é–≤–∞–Ω–Ω—è —Ç–µ–∫—Å—Ç—É */
        }
        
        .loading-spinner {
            width: 50px;
            height: 50px;
            border: 5px solid #333;
            border-top: 5px solid #8a2be2;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin-bottom: 20px;
        }
        
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .hidden {
            display: none !important;
        }
        
        /* –Ü–Ω—Å—Ç—Ä—É–∫—Ü—ñ—è (–∞–¥–∞–ø—Ç–∏–≤–Ω–∏–π –±–ª–æ–∫) */
        #instruction {
            position: absolute;
            bottom: 50px; /* –ó–±—ñ–ª—å—à–µ–Ω–æ –≤—ñ–¥—Å—Ç—É–ø –≤—ñ–¥ –∫—Ä–∞—é –¥–ª—è –º–æ–±—ñ–ª—å–Ω–∏—Ö –ø—Ä–∏—Å—Ç—Ä–æ—ó–≤ */
            left: 50%;
            transform: translateX(-50%); /* –¶–µ–Ω—Ç—Ä—É–≤–∞–Ω–Ω—è –ø–æ X */
            max-width: 90%; /* –û–±–º–µ–∂–µ–Ω–Ω—è —à–∏—Ä–∏–Ω–∏ */
            text-align: center;
            color: white;
            background: rgba(0,0,0,0.8);
            padding: 15px;
            border-radius: 8px;
            font-size: 1.1em;
            z-index: 1000;
        }
    </style>
</head>
<body>
    <div id="loading-screen">
        <div class="loading-spinner"></div>
        <p>–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è –º–∞–≥—ñ—ó...</p>
    </div>

    <div id="instruction" class="hidden">
        üëÜ –¢–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –∫—Ä–∏—à—Ç–∞–ª–µ–≤–æ—ó –∫—É–ª—ñ, —â–æ–± –ø–æ–±–∞—á–∏—Ç–∏ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–æ
    </div>

    <a-scene 
        mindar-image="imageTargetSrc: marker.mind; autoStart: false;" 
        color-space="sRGB" 
        embedded 
        renderer="colorManagement: true, physicallyCorrectLights"
        vr-mode-ui="enabled: false"
        device-orientation-permission-ui="enabled: false"
        id="main-scene"
    >
        
        <a-assets>
            <audio id="fon" src="assets/sounds/fon.mp3" preload="auto"></audio>
            <audio id="fon1" src="assets/sounds/fon1.mp3" preload="auto"></audio>
            <!-- –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–¥–∞–ª–µ–Ω–æ –∑–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è —à—Ä–∏—Ñ—Ç—É, —è–∫–∏–π –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è -->
        </a-assets>

        <a-camera active="false" position="0 0 0">
            <a-cursor raycaster="objects: .clickable" color="#FFF" opacity="0.5"></a-cursor>
        </a-camera>

        <a-entity mindar-image-target="targetIndex: 0" id="marker-anchor">
            
            <a-sphere 
                id="crystal-ball"
                class="clickable"
                radius="0.3" 
                position="0 0.4 0"
                material="shader: custom; opacity: 0.3; refractionRatio: 0.95;"
                crystal-ball
                cursor-listener> </a-sphere>
            
            <a-sphere 
                id="inner-glow"
                radius="0.25" 
                position="0 0.4 0"
                material="shader: flat; color: #4a00e0; opacity: 0.5; transparent: true"
                inner-glow>
            </a-sphere>
            
            <a-ring 
                id="aura"
                radius-inner="0.35" 
                radius-outer="0.5" 
                position="0 0.4 0"
                rotation="-90 0 0"
                material="shader: flat; color: #8a2be2; opacity: 0.3; transparent: true"
                aura-effect>
            </a-ring>
            
            <!-- –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –í–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—è —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–≥–æ —Ç–µ–∫—Å—Ç–æ–≤–æ–≥–æ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ A-Frame -->
            <a-text 
                id="prophecy-text"
                position="0 0.8 0"
                rotation="0 0 0"
                align="center"
                width="3"
                color="#00bfff"
                value=""
                visible="false"
                text-reveal>
            </a-text>
            
            <a-cylinder 
                radius="0.4" 
                height="0.1" 
                position="0 0.05 0"
                material="color: #2c2c2c; roughness: 0.8">
            </a-cylinder>
            
            <!-- –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –ó–∞–º—ñ–Ω–µ–Ω–æ particle-system –Ω–∞ –∞–Ω—ñ–º–∞—Ü—ñ—é —á–∞—Å—Ç–∏–Ω–æ–∫ —á–µ—Ä–µ–∑ A-Frame -->
            <a-entity 
                id="magic-particles"
                position="0 0.4 0"
                magic-particles>
            </a-entity>
        </a-entity>
    </a-scene>

    <script>
        // 1. –ö–ê–°–¢–û–ú–ù–ò–ô –®–ï–ô–î–ï–† –î–õ–Ø –ö–†–ò–®–¢–ê–õ–ï–í–û–á –ö–£–õ–Ü
        AFRAME.registerShader('custom', {
            schema: {
                time: {type: 'time', is: 'uniform', default: 0},
                opacity: {type: 'number', is: 'uniform', default: 0.3},
                refractionRatio: {type: 'number', is: 'uniform', default: 0.95}
            },
            
            vertexShader: `
                varying vec3 vNormal;
                varying vec3 vPosition;
                
                void main() {
                    vNormal = normalize(normalMatrix * normal);
                    vPosition = position;
                    gl_Position = projectionMatrix * modelViewMatrix * vec4(position, 1.0);
                }
            `,
            
            fragmentShader: `
                varying vec3 vNormal;
                varying vec3 vPosition;
                uniform float time;
                uniform float opacity;
                uniform float refractionRatio;
                
                void main() {
                    vec3 normal = normalize(vNormal);
                    float intensity = pow(0.7 - dot(normal, vec3(0.0, 0.0, 1.0)), 4.0);
                    
                    vec3 baseColor = vec3(0.3, 0.1, 0.8);
                    vec3 pulseColor = baseColor * (0.8 + 0.2 * sin(time * 0.005)); 
                    
                    vec3 refracted = refract(vec3(0.0, 0.0, 1.0), normal, refractionRatio);
                    float refractionEffect = dot(refracted, refracted);
                    
                    vec3 finalColor = mix(pulseColor, vec3(1.0), intensity * 0.3);
                    finalColor += refractionEffect * 0.1;
                    
                    gl_FragColor = vec4(finalColor, opacity * (0.7 + 0.3 * intensity));
                }
            `
        });

        // 2. –ö–û–ú–ü–û–ù–ï–ù–¢–ò –ê–ù–Ü–ú–ê–¶–Ü–á
        AFRAME.registerComponent('inner-glow', {
            init: function() {
                this.el.setAttribute('animation', {
                    property: 'components.material.material.opacity',
                    to: '0.8',
                    dir: 'alternate',
                    dur: 2000,
                    loop: true,
                    easing: 'easeInOutSine'
                });
            }
        });

        AFRAME.registerComponent('aura-effect', {
            init: function() {
                this.el.setAttribute('animation', {
                    property: 'scale',
                    to: '1.2 1.2 1.2',
                    dir: 'alternate',
                    dur: 3000,
                    loop: true,
                    easing: 'easeInOutSine'
                });
            }
        });

        // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –ü—Ä–æ—Å—Ç–∞ —Å–∏—Å—Ç–µ–º–∞ —á–∞—Å—Ç–∏–Ω–æ–∫ —á–µ—Ä–µ–∑ —Å—Ç–≤–æ—Ä–µ–Ω–Ω—è –µ–ª–µ–º–µ–Ω—Ç—ñ–≤
        AFRAME.registerComponent('magic-particles', {
            init: function() {
                this.particles = [];
                this.active = false;
            },
            
            activate: function() {
                if (this.active) return;
                this.active = true;
                
                // –°—Ç–≤–æ—Ä—é—î–º–æ —á–∞—Å—Ç–∏–Ω–∫–∏
                for (let i = 0; i < 20; i++) {
                    const particle = document.createElement('a-sphere');
                    particle.setAttribute('radius', '0.02');
                    particle.setAttribute('color', i % 2 === 0 ? '#8a2be2' : '#00bfff');
                    particle.setAttribute('position', '0 0 0');
                    
                    // –í–∏–ø–∞–¥–∫–æ–≤–∏–π –Ω–∞–ø—Ä—è–º–æ–∫
                    const angle = Math.random() * Math.PI * 2;
                    const distance = 0.3 + Math.random() * 0.2;
                    const targetX = Math.cos(angle) * distance;
                    const targetY = Math.random() * 0.5;
                    const targetZ = Math.sin(angle) * distance;
                    
                    particle.setAttribute('animation', {
                        property: 'position',
                        to: `${targetX} ${targetY} ${targetZ}`,
                        dur: 1000 + Math.random() * 500,
                        easing: 'easeOutQuad'
                    });
                    
                    particle.setAttribute('animation__opacity', {
                        property: 'components.material.material.opacity',
                        from: '1',
                        to: '0',
                        dur: 1000 + Math.random() * 500,
                        startEvents: 'animationcomplete'
                    });
                    
                    this.el.appendChild(particle);
                    this.particles.push(particle);
                }
                
                // –û—á–∏—Å—Ç–∫–∞ —á–µ—Ä–µ–∑ 2 —Å–µ–∫—É–Ω–¥–∏
                setTimeout(() => {
                    this.particles.forEach(particle => {
                        if (particle.parentNode) {
                            particle.parentNode.removeChild(particle);
                        }
                    });
                    this.particles = [];
                    this.active = false;
                }, 2000);
            }
        });
        
        // –í–ò–ü–†–ê–í–õ–ï–ù–ù–Ø: –°–ø—Ä–æ—â–µ–Ω–∏–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç –¥–ª—è —Ç–µ–∫—Å—Ç—É
        AFRAME.registerComponent('text-reveal', {
            schema: {
                text: {type: 'string', default: ''},
                speed: {type: 'number', default: 50}
            },
            
            init: function() {
                this.revealing = false;
                this.currentText = '';
                this.charIndex = 0;
                this.timeout = null;
            },
            
            startReveal: function(text) {
                if (this.revealing) {
                    clearTimeout(this.timeout);
                }
                
                this.revealing = true;
                this.currentText = text;
                this.charIndex = 0;
                this.el.setAttribute('visible', true);
                this.el.setAttribute('value', '');
                
                this.revealNextChar();
            },
            
            revealNextChar: function() {
                if (this.charIndex >= this.currentText.length) {
                    this.revealing = false;
                    
                    // –î–æ–¥–∞—î–º–æ –ø—É–ª—å—Å–∞—Ü—ñ—é –∫–æ–ª—å–æ—Ä—É –ø—ñ—Å–ª—è –∑–∞–≤–µ—Ä—à–µ–Ω–Ω—è
                    this.el.setAttribute('animation', {
                        property: 'color',
                        from: '#8a2be2',
                        to: '#00bfff',
                        dir: 'alternate',
                        dur: 2000,
                        loop: true
                    });
                    return;
                }
                
                const currentValue = this.el.getAttribute('value') || '';
                this.el.setAttribute('value', currentValue + this.currentText[this.charIndex]);
                
                this.charIndex++;
                this.timeout = setTimeout(() => this.revealNextChar(), this.data.speed);
            }
        });
        
        // 4. –û–°–ù–û–í–ù–ê –õ–û–ì–Ü–ö–ê –î–û–î–ê–¢–ö–£
        document.addEventListener('DOMContentLoaded', function() {
            const scene = document.querySelector('a-scene');
            const loadingScreen = document.getElementById('loading-screen');
            const instruction = document.getElementById('instruction');
            const crystalBall = document.getElementById('crystal-ball');
            const innerGlow = document.getElementById('inner-glow');
            const prophecyText = document.getElementById('prophecy-text');
            const particles = document.querySelector('[magic-particles]');
            const aura = document.getElementById('aura');
            const backgroundSound = document.getElementById('fon');
            const magicSound = document.getElementById('fon1');
            
            let systemReady = false;
            let prophecyActive = false;
            
            const prophecies = [
                "–®–ª—è—Ö –¥–æ –£—Å–ø—ñ—Ö—É –ª–µ–∂–∏—Ç—å —á–µ—Ä–µ–∑ –∑–Ω–∞–Ω–Ω—è —Ç–∞ –ù–∞–ø–æ–ª–µ–≥–ª–∏–≤—ñ—Å—Ç—å",
                "–ù–æ–≤—ñ –ú–æ–∂–ª–∏–≤–æ—Å—Ç—ñ –≤—ñ–¥–∫—Ä–∏—é—Ç—å—Å—è –ø–µ—Ä–µ–¥ –≤–∞–º–∏ –¥—É–∂–µ —Å–∫–æ—Ä–æ",
                "–î–æ–≤—ñ—Ä—è–π—Ç–µ —Å–≤–æ—ó–π –Ü–Ω—Ç—É—ó—Ü—ñ—ó - –≤–æ–Ω–∞ –ø—Ä–∏–≤–µ–¥–µ –≤–∞—Å –¥–æ –º–µ—Ç–∏",
                "–ó—É—Å—Ç—Ä—ñ—á –∑ –≤–∞–∂–ª–∏–≤–æ—é –ª—é–¥–∏–Ω–æ—é –ó–º—ñ–Ω–∏—Ç—å –≤–∞—à–µ –∂–∏—Ç—Ç—è",
                "–í–∞—à–∞ –¢–≤–æ—Ä—á—ñ—Å—Ç—å –ø—Ä–∏–Ω–µ—Å–µ –Ω–µ—Å–ø–æ–¥—ñ–≤–∞–Ω—ñ –ø–ª–æ–¥–∏",
                "–ü–æ–¥–æ—Ä–æ–∂ –≤—ñ–¥–∫—Ä–∏—î –ù–æ–≤—ñ –ì–æ—Ä–∏–∑–æ–Ω—Ç–∏ –¥–ª—è —Ä–æ–∑–≤–∏—Ç–∫—É",
                "–í—ñ—Ä–∞ –≤ —Å–µ–±–µ - –ö–ª—é—á –¥–æ –ø–æ–¥–æ–ª–∞–Ω–Ω—è –±—É–¥—å-—è–∫–∏—Ö –ø–µ—Ä–µ—à–∫–æ–¥"
            ];
            
            scene.addEventListener('loaded', function() {
                const mindarSystem = scene.systems["mindar-image-system"];
                mindarSystem.start(); 
                
                backgroundSound.volume = 0.3;
                backgroundSound.loop = true;
                backgroundSound.play().catch(e => console.log('Auto-play blocked, wait for user interaction'));

                loadingScreen.classList.add('hidden');
                instruction.classList.remove('hidden');
                systemReady = true;

                document.body.addEventListener('touchstart', function handleFirstInteraction() {
                    backgroundSound.play().catch(e => {}); 
                    document.body.removeEventListener('touchstart', handleFirstInteraction);
                });
            });
            
            crystalBall.addEventListener('click', function() {
                if (!systemReady || prophecyActive) return;
                startProphecy();
            });
            
            function startProphecy() {
                prophecyActive = true;
                instruction.classList.add('hidden');
                
                const randomProphecy = prophecies[Math.floor(Math.random() * prophecies.length)];
                
                // –§–∞–∑–∞ –Ω–∞–∫–æ–ø–∏—á–µ–Ω–Ω—è –µ–Ω–µ—Ä–≥—ñ—ó
                crystalBall.setAttribute('animation', {
                    property: 'components.material.material.uniforms.time.value',
                    to: 5000,
                    dur: 1000,
                    easing: 'easeInQuad'
                });
                
                innerGlow.setAttribute('animation', {
                    property: 'components.material.material.opacity',
                    to: 1.0,
                    dur: 1000,
                    easing: 'easeInQuad'
                });
                
                setTimeout(() => {
                    // –í–∏–±—É—Ö –µ–Ω–µ—Ä–≥—ñ—ó
                    aura.setAttribute('material', 'opacity', 0.8);
                    aura.setAttribute('animation', {
                        property: 'scale',
                        to: '2 2 2',
                        dur: 300,
                        easing: 'easeOutQuad'
                    });
                    
                    particles.components['magic-particles'].activate();
                    
                    magicSound.currentTime = 0;
                    magicSound.volume = 0.7;
                    magicSound.play();
                    
                    setTimeout(() => {
                        // –ü–æ—è–≤–∞ —Ç–µ–∫—Å—Ç—É
                        prophecyText.components['text-reveal'].startReveal(randomProphecy);
                        
                        setTimeout(() => {
                            // –°—Ç–∞–±—ñ–ª—ñ–∑–∞—Ü—ñ—è
                            crystalBall.setAttribute('animation', {
                                property: 'components.material.material.uniforms.time.value',
                                to: 20000,
                                dur: 3000,
                                easing: 'easeOutQuad'
                            });
                            
                            innerGlow.setAttribute('animation', {
                                property: 'components.material.material.opacity',
                                to: 0.3,
                                dur: 3000,
                                easing: 'easeOutQuad'
                            });
                            
                            aura.setAttribute('material', 'opacity', 0.3);
                            aura.setAttribute('scale', '1 1 1');
                            
                            setTimeout(() => {
                                prophecyActive = false;
                                instruction.classList.remove('hidden');
                                instruction.textContent = 'üëÜ –ó–Ω–æ–≤—É —Ç–æ—Ä–∫–Ω—ñ—Ç—å—Å—è –∫—É–ª—ñ –¥–ª—è –Ω–æ–≤–æ–≥–æ –ø—Ä–æ—Ä–æ—Ü—Ç–≤–∞.';
                            }, 5000);
                            
                        }, 3000);
                    }, 500);
                }, 1000);
            }
        });
    </script>
</body>
</html>
